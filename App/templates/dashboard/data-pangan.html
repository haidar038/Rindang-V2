{% extends 'dashboard/layout.html' %} {% block page_title %} Dashboard - Data Pangan {% endblock %} {% block container
%}
<div class="container-fluid">
    <!--  Row 1 -->
    <div class="row">
        <div class="col-lg-6 col-12 d-flex align-items-strech">
            <!-- Chart -->
            <div class="card w-100">
                <div class="card-body">
                    <div class="d-sm-flex d-block align-items-center justify-content-between mb-9">
                        <div class="mb-3 mb-sm-0">
                            <h5 class="card-title text-dark-emphasis">
                                <strong>Statistik Panen Rindang</strong>
                            </h5>
                        </div>
                        <div>
                            <select class="form-select" id="select-pangan">
                                <option value="chart">Cabai</option>
                                <option value="chart2">Tomat</option>
                            </select>
                        </div>
                    </div>
                    <div class="date-filter d-flex gap-3 mb-3">
                        <div class="d-flex flex-column w-100">
                            <label for="start-date">Start Date:</label>
                            <input class="form-control" type="date" id="start-date" name="start-date" />
                        </div>
                        <div class="d-flex flex-column w-100">
                            <label for="end-date">End Date:</label>
                            <input class="form-control" type="date" id="end-date" name="end-date" />
                        </div>
                        <div class="d-flex flex-column gap-2">
                            <button class="btn btn-green" id="filter-button">Filter</button>
                            <button class="btn btn-outline-dark" id="reset-button">Reset</button>
                        </div>
                    </div>
                    <div id="chart"></div>
                    <!-- <div id="chart2" style="display: none;"></div> -->
                </div>
            </div>
            <!-- Chart End -->
        </div>
        <div class="col-lg-6 col-12">
            <!-- Yearly Breakup -->
            <div class="card overflow-hidden">
                <div class="card-body">
                    <div class="mb-3">
                        <h5 class="card-title text-dark-emphasis">
                            <strong>Akumulasi Hasil Produksi</strong>
                        </h5>

                        <em class="text-muted">Informasi Bulan Ini</em>
                    </div>
                    <div class="row align-items-center">
                        <div class="col-12">
                            {% if pangan %} {% set jml_panen = total_panen/1000 %}
                            <p class="mb-3 display-5">
                                <strong>{{ jml_panen | default("0") }} kg</strong>
                            </p>
                            {% else %}
                            <p class="mb-3 display-6"><strong>0 kg</strong></p>
                            {% endif %}
                            <!-- <div class="d-flex align-items-center">
        <div class="me-4">
          <span class="round-8 rounded-circle me-2 d-inline-block" style="background-color: #ff6b6b"></span>
          <span class="fs-2">Cabai</span>
        </div>
        <div>
          <span class="round-8 rounded-circle me-2 d-inline-block" style="background-color: #fcb45e"></span>
          <span class="fs-2">Tomat</span>
        </div>
      </div> -->
                        </div>
                        <div class="col-12">
                            <div class="row">
                                <div class="col-6">
                                    <p class="mb-0"><span class="round-8 rounded-circle me-2 d-inline-block"
                                            style="background-color: #ff6b6b"></span> Cabai</p>
                                    <div class="d-flex align-items-center mb-3">
                                        <span
                                            class="me-1 rounded-circle bg-light-success round-20 d-flex align-items-center justify-content-center">
                                            {% if kenaikan_cabai > 0 %}
                                            <i class="ti ti-trending-up text-success"></i>
                                            {% elif kenaikan_cabai < 0 %} <i class="ti ti-trending-down text-danger">
                                                </i>
                                                {% endif %}
                                        </span>
                                        <p class="text-dark me-1 fs-3 mb-0 text-wrap">
                                            {% if kenaikan_cabai > 0 %} + {{ kenaikan_cabai }}% dibandingkan panen
                                            sebelumnya {% elif kenaikan_cabai < 0 %} {{ kenaikan_cabai }}% dibandingkan
                                                panen sebelumnya {% elif kenaikan_cabai==0 %} <em class="text-muted">
                                                <strong>belum ada data perbandingan</strong></em> {% endif %}
                                        </p>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <p class="mb-0"><span class="round-8 rounded-circle me-2 d-inline-block"
                                            style="background-color: #fcb45e"></span> Tomat</p>
                                    <div class="d-flex align-items-center mb-3">
                                        <span
                                            class="me-1 rounded-circle bg-light-success round-20 d-flex align-items-center justify-content-center">
                                            {% if kenaikan_tomat > 0 %}
                                            <i class="ti ti-trending-up text-success"></i>
                                            {% elif kenaikan_tomat < 0 %} <i class="ti ti-trending-down text-danger">
                                                </i>
                                                {% endif %}
                                        </span>
                                        <p class="text-dark me-1 fs-3 mb-0 text-wrap">
                                            {% if kenaikan_tomat > 0 %} + {{ kenaikan_tomat }}% {% elif kenaikan_tomat <
                                                0 %} {{ kenaikan_tomat }} {% elif kenaikan_tomat==0 %} <em
                                                class="text-muted"><strong>belum ada data perbandingan</strong></em> {%
                                                endif %}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="d-flex justify-content-center">
                                <div id="breakup"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <!-- Modal Input Data Baru -->
        <div class="modal fade" id="inputData" tabindex="-1" aria-labelledby="inputDataLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content p-3">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5 fw-bold" id="inputDataLabel">Input Data Produksi</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form action="" method="post">
                            <div class="mb-3">
                                <label for="kebun" class="form-label fw-bold fs-4">Kebun</label>
                                <select class="form-select" aria-label="kebun" id="kebun" name="kebun">
                                    <option value="Kebun 1">Kebun 1</option>
                                    <option value="Kebun 2">Kebun 2</option>
                                    <option value="Kebun 3">Kebun 3</option>
                                    <option value="Kebun 4">Kebun 4</option>
                                    <option value="Kebun 5">Kebun 5</option>
                                    <option value="Kebun 6">Kebun 6</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="komoditas" class="form-label fw-bold fs-4">Komoditas</label>
                                <select class="form-select" aria-label="Komoditas" id="komoditas" name="komoditas">
                                    <option value="Cabai">Cabai</option>
                                    <option value="Tomat">Tomat</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <div class="row">
                                    <div class="col">
                                        <label for="tglBibit" class="form-label fw-bold fs-4">Tanggal Penanaman</label>
                                        <input type="date" class="form-control" id="tglBibit" name="tglBibit"
                                            required />
                                    </div>
                                    <div class="col">
                                        <label for="jumlahBibit" class="form-label fw-bold fs-4">Jumlah Bibit</label>
                                        <input type="number" class="form-control" id="jumlahBibit" name="jumlahBibit"
                                            placeholder="contoh: 1000" required />
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center">
                                <button type="submit" class="btn btn-green w-100">Input Data</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Update Data Produksi -->
        {% for dataPangan in pangan %}
        <div class="modal fade" id="updateData{{dataPangan.id}}" tabindex="-1"
            aria-labelledby="updateDataLabel{{dataPangan.id}}" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content p-3">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5 fw-bold" id="inputDataLabel">
                            Update Data Produksi &nbsp; <span
                                class="badge {% if dataPangan.status == 'Penanaman' %} bg-warning {% else %} bg-green {% endif %}">{{
                                dataPangan.status }}</span>
                        </h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-4">
                            <div class="col">
                                <button class="btn btn-success" data-bs-target="#panenModal{{dataPangan.id}}"
                                    data-bs-toggle="modal">{% if dataPangan.status == 'Panen' %} Lihat/Update Data Panen
                                    {% else %} Panen {% endif %}</button>
                            </div>
                        </div>
                        <form action="{{ url_for('views.updatepangan', id=dataPangan.id ) }}" method="post">
                            <input type="text" class="visually-hidden" value="updateProduksi" name="updateProduksi" />
                            <div class="mb-3">
                                <label for="updateKebun" class="form-label fw-bold fs-4">Kebun</label>
                                <select class="form-select" aria-label="updateKebun" id="updateKebun"
                                    name="updateKebun">
                                    <option value="{{dataPangan.kebun}}">{{dataPangan.kebun}}</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="updateKomoditas" class="form-label fw-bold fs-4">Komoditas</label>
                                <select class="form-select" aria-label="Komoditas" id="updateKomoditas"
                                    name="updateKomoditas">
                                    <option value="{{dataPangan.komoditas}}">{{dataPangan.komoditas}}</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <div class="row">
                                    <div class="col">
                                        <label for="updateTglBibit" class="form-label fw-bold fs-4">Tanggal
                                            Penanaman</label>
                                        <input type="date" class="form-control" id="updateTglBibit"
                                            name="updateTglBibit" value="{{dataPangan.tanggal_bibit}}" required />
                                    </div>
                                    <div class="col">
                                        <label for="updateJumlahBibit" class="form-label fw-bold fs-4">Jumlah
                                            Bibit</label>
                                        <input type="number" class="form-control" id="updateJumlahBibit"
                                            name="updateJumlahBibit" value="{{dataPangan.jml_bibit}}"
                                            placeholder="contoh: 1000" required />
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center">
                                <button type="submit" class="btn btn-green w-100">Update Data Produksi</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

        <!-- UPDATE MODAL PANEN -->
        {% for dataPangan in pangan %}
        <div class="modal fade" id="panenModal{{dataPangan.id}}" aria-hidden="true"
            aria-labelledby="panenModal{{dataPangan.id}}Label" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="panenModal{{dataPangan.id}}Label">Panen</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-2">
                            <form action="{{ url_for('views.updatepangan', id=dataPangan.id ) }}" method="post">
                                <input type="text" class="visually-hidden" value="dataPanen" name="updateProduksi" />
                                <div class="col mb-3">
                                    <label for="updateTglPanen" class="form-label fw-bold fs-4">Tanggal Panen</label>
                                    <input type="date" class="form-control panen" id="updateTglPanen" {% if
                                        dataPangan.status=='Panen' %} value="{{dataPangan.tanggal_panen}}" {% endif %}
                                        name="updateTglPanen" required />
                                </div>
                                <div class="col mb-4">
                                    <label for="updateJumlahPanen" class="form-label fw-bold fs-4">Hasil Panen
                                        (g)</label>
                                    <input type="number" class="form-control panen" id="updateJumlahPanen"
                                        name="updateJumlahPanen" {% if dataPangan.status=='Panen' %}
                                        value="{{dataPangan.jml_panen}}" {% endif %} placeholder="contoh:
                                    1000" required />
                                </div>
                                <button class="btn btn-green" type="submit">Submit Hasil Panen</button>
                            </form>
                        </div>
                        <div class="row">
                            <div class="col">
                                <button class="btn btn-outline-dark" data-bs-target="#updateData{{dataPangan.id}}"
                                    data-bs-toggle="modal">Kembali</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

        <div class="col-lg-12 d-flex align-items-stretch">
            <div class="card w-100">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="card-title fw-semibold">Laporan Hasil Penanaman - Panen</h5>

                        <button id="inputDataBtn" type="button" class="btn btn-green rounded-4" data-bs-toggle="modal"
                            data-bs-target="#inputData">Input Data Produksi</button>
                    </div>

                    <nav>
                        <div class="nav nav-tabs" id="nav-tab" role="tablist">
                            <button class="nav-link text-green active" id="nav-home-tab" data-bs-toggle="tab"
                                data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home"
                                aria-selected="true">Cabai</button>
                            <button class="nav-link text-green" id="nav-profile-tab" data-bs-toggle="tab"
                                data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile"
                                aria-selected="false">Tomat</button>
                        </div>
                    </nav>

                    <div class="tab-content" id="nav-tabContent">
                        <div class="tab-pane fade show active" id="nav-home" role="tabpanel"
                            aria-labelledby="nav-home-tab" tabindex="0">
                            <div class="table-responsive">
                                <table class="table text-nowrap mb-0 align-middle">
                                    <thead class="text-dark fs-4">
                                        <tr>
                                            <th class="max-width">
                                                <h6 class="fw-semibold mb-0">No</h6>
                                            </th>
                                            <th class="">
                                                <h6 class="fw-semibold mb-0">Kebun</h6>
                                            </th>
                                            <th class="">
                                                <h6 class="fw-semibold mb-0">Jumlah Bibit</h6>
                                            </th>
                                            <th class="">
                                                <h6 class="fw-semibold mb-0">Tanggal Penanaman</h6>
                                            </th>
                                            <th class="">
                                                <h6 class="fw-semibold mb-0">Status</h6>
                                            </th>
                                            <th class="">
                                                <h6 class="fw-semibold mb-0">Hasil Panen (kg)</h6>
                                            </th>
                                            <th class="">
                                                <h6 class="fw-semibold mb-0">Menu</h6>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for data_cabai in cabai %}
                                        <tr>
                                            <td class="border-bottom-0">
                                                <h6 class="fw-semibold mb-0">{{ loop.index }}</h6>
                                            </td>
                                            <td class="border-bottom-0">
                                                <h6 class="fw-semibold mb-1">{{ data_cabai.kebun }}</h6>
                                                <!-- <span class="fw-normal">Skala Besar</span> -->
                                            </td>
                                            <td class="border-bottom-0">
                                                <p class="mb-0 fw-normal">{{ data_cabai.jml_bibit }}</p>
                                            </td>
                                            <td class="border-bottom-0">
                                                <p class="mb-0 fw-normal" id="tglTanamCabai">{{
                                                    data_cabai.tanggal_bibit}}</p>
                                            </td>
                                            <td class="border-bottom-0">
                                                <div class="d-flex align-items-center gap-2">
                                                    <span
                                                        class="badge {% if data_cabai.status == 'Panen' %} bg-green {% else %} bg-yellow {% endif %} rounded-3 fw-semibold">{{
                                                        data_cabai.status }}</span>
                                                </div>
                                            </td>
                                            <td class="border-bottom-0">
                                                <div class="fw-bold">
                                                    <strong>{{ data_cabai.jml_panen/1000 }}</strong>
                                                </div>
                                                <div class="small" id="tglPanenCabai">{{ data_cabai.tanggal_panen }}
                                                </div>
                                            </td>
                                            <td class="border-bottom-0 align-middle">
                                                <a class="btn btn-danger fs-6"
                                                    href="{{ url_for('views.delete_data_pangan', id=data_cabai.id ) }}"><i
                                                        class="ti ti-trash"></i></a>
                                                <button id="updateDataBtn" type="button" class="btn btn-green fs-6"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#updateData{{data_cabai.id}}"><i
                                                        class="ti ti-edit"></i></button>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab"
                            tabindex="0">
                            <div class="table-responsive">
                                <table class="table text-nowrap mb-0 align-middle">
                                    <thead class="text-dark fs-4">
                                        <tr>
                                            <th class="max-width">
                                                <h6 class="fw-semibold mb-0">No</h6>
                                            </th>
                                            <th class="">
                                                <h6 class="fw-semibold mb-0">Kebun</h6>
                                            </th>
                                            <th class="">
                                                <h6 class="fw-semibold mb-0">Jumlah Bibit</h6>
                                            </th>
                                            <th class="">
                                                <h6 class="fw-semibold mb-0">Tanggal Penanaman</h6>
                                            </th>
                                            <th class="">
                                                <h6 class="fw-semibold mb-0">Status</h6>
                                            </th>
                                            <th class="">
                                                <h6 class="fw-semibold mb-0">Hasil Panen (kg)</h6>
                                            </th>
                                            <th class="">
                                                <h6 class="fw-semibold mb-0">Menu</h6>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for data_tomat in tomat %}
                                        <tr>
                                            <td class="border-bottom-0">
                                                <h6 class="fw-semibold mb-0">{{ loop.index }}</h6>
                                            </td>
                                            <td class="border-bottom-0">
                                                <h6 class="fw-semibold mb-1">{{ data_tomat.kebun }}</h6>
                                                <!-- <span class="fw-normal">Skala Besar</span> -->
                                            </td>
                                            <td class="border-bottom-0">
                                                <p class="mb-0 fw-normal">{{ data_tomat.jml_bibit }}</p>
                                            </td>
                                            <td class="border-bottom-0">
                                                <p class="mb-0 fw-normal">{{ data_tomat.tanggal_bibit }}</p>
                                            </td>
                                            <td class="border-bottom-0">
                                                <div class="d-flex align-items-center gap-2">
                                                    <span
                                                        class="badge {% if data_tomat.status == 'Panen' %} bg-green {% else %} bg-yellow {% endif %} rounded-3 fw-semibold">{{
                                                        data_tomat.status }}</span>
                                                </div>
                                            </td>
                                            <td class="border-bottom-0">
                                                <div class="fw-bold">
                                                    <strong>{{ data_tomat.jml_panen/1000 }}</strong>
                                                </div>
                                                <div class="small">{{ data_tomat.tanggal_panen }}</div>
                                            </td>
                                            <td class="border-bottom-0 align-middle">
                                                <a class="btn btn-danger fs-6"
                                                    href="{{ url_for('views.delete_data_pangan', id=data_tomat.id ) }}"><i
                                                        class="ti ti-trash"></i></a>
                                                <button id="updateDataBtn" type="button" class="btn btn-green fs-6"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#updateData{{data_tomat.id}}"><i
                                                        class="ti ti-edit"></i></button>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} {% block scripts %}
<script>
    let statCabai = {{ stat_cabai | safe }};
    let statTomat = {{ stat_tomat | safe }};
    let tanggalCabai = {{ tgl_panen_cabai | safe}};
    let tanggalTomat = {{ tgl_panen_tomat | safe}};

    let statCabaiConv = statCabai.map((value) => value / 1000);
    let statTomatConv = statTomat.map((value) => value / 1000);

    let bulanIndonesia = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
    // let HariIndonesia = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];

    let formattedDates = tanggalCabai.map((tanggal) => {
        let dateObject = new Date(tanggal); // konversi ke objek Date

        // format tanggal menjadi "Tanggal Bulan Tahun"
        tanggal = dateObject.getDate();
        let bulan = bulanIndonesia[dateObject.getMonth()]; // bulan di JavaScript dimulai dari 0
        let tahun = dateObject.getFullYear();

        return tanggal + " " + bulan + " " + tahun;
    });

    console.log(formattedDates); // output: array tanggal dalam format "Tanggal Bulan Tahun"
    console.log(tanggalCabai);

    $(function () {
        // =====================================
        // Profit
        // =====================================
        var cabaiBar = {
            series: [{ name: "Panen Cabai", data: statCabaiConv }],

            chart: {
                type: "bar",
                height: 345,
                offsetX: -15,
                toolbar: { show: true },
                foreColor: "#adb0bb",
                fontFamily: "inherit",
                sparkline: { enabled: false },
            },

            colors: "#ff6b6b",

            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: "35%",
                    borderRadius: [6],
                    borderRadiusApplication: "end",
                    borderRadiusWhenStacked: "all",
                },
            },
            markers: { size: 0 },

            dataLabels: {
                enabled: false,
            },

            legend: {
                show: false,
            },

            grid: {
                borderColor: "rgba(0,0,0,0.1)",
                strokeDashArray: 3,
                xaxis: {
                    lines: {
                        show: false,
                    },
                },
            },

            xaxis: {
                type: "datetime",
                categories: tanggalCabai,
                labels: {
                    style: { cssClass: "grey--text lighten-2--text fill-color" },
                },
            },

            yaxis: {
                show: true,
                min: 0,
                max: 20,
                tickAmount: 4,
                labels: {
                    style: {
                        cssClass: "grey--text lighten-2--text fill-color",
                    },
                },
            },
            stroke: {
                show: true,
                width: 3,
                lineCap: "butt",
                colors: ["transparent"],
            },

            tooltip: { theme: "light" },

            responsive: [
                {
                    breakpoint: 600,
                    options: {
                        plotOptions: {
                            bar: {
                                borderRadius: 3,
                            },
                        },
                    },
                },
            ],
        };

        var tomatBar = {
            series: [{ name: "Panen Tomat", data: statTomatConv }],

            chart: {
                type: "bar",
                height: 345,
                offsetX: -15,
                toolbar: { show: true },
                foreColor: "#adb0bb",
                fontFamily: "inherit",
                sparkline: { enabled: false },
            },

            colors: "#fcb45e",

            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: "35%",
                    borderRadius: [6],
                    borderRadiusApplication: "end",
                    borderRadiusWhenStacked: "all",
                },
            },
            markers: { size: 0 },

            dataLabels: {
                enabled: false,
            },

            legend: {
                show: false,
            },

            grid: {
                borderColor: "rgba(0,0,0,0.1)",
                strokeDashArray: 3,
                xaxis: {
                    lines: {
                        show: false,
                    },
                },
            },

            xaxis: {
                type: "category",
                categories: tanggalTomat,
                labels: {
                    style: { cssClass: "grey--text lighten-2--text fill-color" },
                },
            },

            yaxis: {
                show: true,
                min: 0,
                max: 20,
                tickAmount: 4,
                labels: {
                    style: {
                        cssClass: "grey--text lighten-2--text fill-color",
                    },
                },
            },
            stroke: {
                show: true,
                width: 3,
                lineCap: "butt",
                colors: ["transparent"],
            },

            tooltip: { theme: "light" },

            responsive: [
                {
                    breakpoint: 600,
                    options: {
                        plotOptions: {
                            bar: {
                                borderRadius: 3,
                            },
                        },
                    },
                },
            ],
        };

        var chartcabai = new ApexCharts(document.querySelector("#chart"), cabaiBar);
        var charttomat = new ApexCharts(document.querySelector("#chart2"), tomatBar);
        chartcabai.render();

        function filterPangan() {
            var x = document.getElementById("select-pangan").value;
            if (x === "chart") {
                chartcabai.updateOptions({
                    series: [{ name: "Panen Cabai", data: statCabaiConv }],
                    colors: "#ff6b6b",
                    xaxis: {
                        categories: tanggalCabai,
                        labels: {
                            style: { cssClass: "grey--text lighten-2--text fill-color" },
                        },
                    },
                });
            } else if (x === "chart2") {
                chartcabai.updateOptions({
                    series: [{ name: "Panen Tomat", data: statTomatConv }],
                    colors: "#fcb45e",
                    xaxis: {
                        categories: tanggalTomat,
                        labels: {
                            style: { cssClass: "grey--text lighten-2--text fill-color" },
                        },
                    },
                });
            }
        }

        document.getElementById("select-pangan").onchange = filterPangan;

        // =====================================
        // Jumlah Kebutuhan dan Hasil Produksi
        // =====================================
        let totalPanenCabai = parseInt("{{totalPanenCabai}}", 10);
        let totalPanenTomat = parseInt("{{totalPanenTomat}}", 10);

        var breakup = {
            color: "#adb5bd",
            series: [totalPanenCabai, totalPanenTomat],
            labels: ["Cabai", "Tomat"],
            chart: {
                width: 260,
                type: "donut",
                fontFamily: "Plus Jakarta Sans', sans-serif",
                foreColor: "#adb0bb",
            },
            plotOptions: {
                pie: {
                    startAngle: 0,
                    endAngle: 360,
                    donut: {
                        size: "75%",
                    },
                },
            },
            stroke: {
                show: false,
            },

            dataLabels: {
                enabled: false,
            },

            legend: {
                show: false,
            },
            colors: ["#ff6b6b", "#fcb45e"],

            responsive: [
                {
                    breakpoint: 991,
                    options: {
                        chart: {
                            width: 150,
                        },
                    },
                },
            ],
            tooltip: {
                theme: "dark",
                fillSeriesColor: false,
            },
        };

        var chart = new ApexCharts(document.querySelector("#breakup"), breakup);
        chart.render();

        // Get references to the date input elements and the filter button
        const startDateInput = document.getElementById("start-date");
        const endDateInput = document.getElementById("end-date");
        const filterButton = document.getElementById("filter-button");

        // Add event listener to the filter button
        filterButton.addEventListener("click", function () {
            // Get the selected date range
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);

            // Filter the data based on the selected date range
            const filteredCabaiData = statCabaiConv.filter((value, index) => {
                const date = new Date(tanggalCabai[index]);
                return date >= startDate && date <= endDate;
            });

            const filteredTomatData = statTomatConv.filter((value, index) => {
                const date = new Date(tanggalTomat[index]);
                return date >= startDate && date <= endDate;
            });

            // Update the chart data with the filtered data
            // chartcabai.updateSeries([{ name: "Panen Cabai", data: filteredCabaiData }]);
            // charttomat.updateSeries([{ name: "Panen Tomat", data: filteredTomatData }]);

            const filteredTanggalCabai = tanggalCabai.filter((tanggal, index) => {
                const date = new Date(tanggal);
                return date >= startDate && date <= endDate;
            });

            const filteredTanggalTomat = tanggalTomat.filter((tanggal, index) => {
                const date = new Date(tanggal);
                return date >= startDate && date <= endDate;
            });

            chartcabai.updateOptions({
                series: [{ name: "Panen Cabai", data: filteredCabaiData }],
                xaxis: {
                    categories: filteredTanggalCabai,
                    // ...
                },
            });

            charttomat.updateOptions({
                series: [{ name: "Panen Tomat", data: filteredTomatData }],
                xaxis: {
                    categories: filteredTanggalTomat,
                    // ...
                },
            });
        });

        const resetButton = document.getElementById("reset-button");

        // Add event listener to the reset button
        // ... (rest of the script)

        resetButton.addEventListener("click", function () {
            // Update the chart data with the original data
            chartcabai.updateSeries([{ name: "Panen Cabai", data: statCabaiConv }]);
            charttomat.updateSeries([{ name: "Panen Tomat", data: statTomatConv }]);

            // Reset the x-axis categories to the original dates
            chartcabai.updateOptions({
                xaxis: {
                    categories: tanggalCabai,
                },
            });

            charttomat.updateOptions({
                xaxis: {
                    categories: tanggalTomat,
                },
            });

            // Optionally, reset the date range inputs (if you have them)
            startDateInput.value = "";
            endDateInput.value = "";
        });
    });
</script>
{% endblock %}